<!DOCTYPE html>

<html lang="en">
    <head>
        <title>VisualTimer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">
        <style>
            html, body, div {
                width: 95%;
                min-height: 100%;
            }

            div {
                height: 80px;
                width: 80px;
                float: left;
                background-color: green;
                border-radius: 2px;
                margin: 2px;
            }
        </style>

        <!-- Fav and touch icons -->
        <link rel="shortcut icon" href="bootstrap/ico/favicon.ico">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="bootstrap/ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="bootstrap/ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="bootstrap/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="bootstrap/ico/apple-touch-icon-57-precomposed.png">
    </head>

    <body>
        <!-- BODY -->
        <!-- <div id="test" style="border: 2px solid red"></div> -->
    </body>

    <script type="text/javascript" src="3rd/jquery-1.8.3.js"></script>
    <script type="text/javascript">
        var t;

        'use strict'

        var SECOND = 1000,
            MINUTE = SECOND * 60;

            timer = function() {

                /**
                 * variables
                 */
                var self = {},
                    running,
                    parent,
                    next,
                    interval;

                /**
                 * task runner
                 */
                var intervalId = setInterval(function() {

                    if (self.isRunning() && isNext()) {
                        //remove node
                        var divs = $('body').find('div'),
                            node = $(divs[divs.length-1]);
                        if (divs.length !== 0)
                            node.fadeOut(400, function() { node.remove(); } );
                        else {
                            clearInterval(intervalId);
                            debugger;
                        }
                    }
                }, SECOND/10)

                /**
                 * get current timestamp
                 * @return {number} timestamp
                 */
                now = function () {
                    return (new Date()).getTime();
                }

                /**
                 * execute next step
                 * @return {boolean}
                 */
                isNext = function() {
                    //console.log(next, now(), next - now())
                    var is = ( next || now() ) <= now();
                    if (is)
                        next = now() + interval;
                    return is;
                }


                /**
                 * get one dot node
                 * @param  {numeric} id
                 * @return {jquery}
                 */
                dot = function (id) {
                    return $('<div>')
                            .attr('id', id);
                }

                /**
                 * append timer to node
                 * @param  {number} time in milliseconds
                 * @param  {jquery} node
                 * @return {object} timer
                 */
                self.init = function(time, node) {
                    parent = node ||Â $('body');
                    time = time || MINUTE;
                    interval = SECOND;
                    var nodes = [];

                    //viewport
                    var rows = $(window).height() / 95;
                    var cols = $(window).width() / 95;
                    var count = Math.round(rows * cols);

                    //get interval to remove last
                    //dot when countdown ends
                    interval = time/count

                    //add nodes
                    for (var i = count; i >= 0; i--) {
                        nodes.push(dot(i));
                    };
                    parent.append(nodes)
                    return this;
                }

                /**
                 * @return {Boolean}
                 */
                self.isRunning = function() {
                    return running;
                }

                /**
                 * @return timer
                 */
                self.start = function() {
                    running = true;
                    return this;
                }

                /**
                 * @return timer
                 */
                self.pause = function() {
                    running = false;
                    return this;
                }

                /**
                 * @return timer
                 */
                self.reset = function() {
                    return self.init(parent);
                }

                return self;
            }

        //onready
       $(window).load(function() {
        console.log($('body').height())
            t = timer().init(10 * SECOND).start();
            //t.pause();
        });

    </script>
</html>